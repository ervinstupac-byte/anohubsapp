# AnoHUB Forensic Gate ‚Äî Master README

## System Architecture
- Canonical dossier manifest: generated by `scripts/generate_library.py` and materialized as `scripts/hashes_applied.json`. The runtime loader builds the canonical library in `src/data/knowledge/DossierLibrary.ts` which exposes `DOSSIER_LIBRARY`, `PATH_INDEX`, and `resolveDossier()` for consumers.  
- The `MasterIntelligenceEngine` ([src/services/MasterIntelligenceEngine.ts](src/services/MasterIntelligenceEngine.ts)) ingests sensor telemetry, runs cross-correlation and safety rules, and emits `automatedActions` when thresholds are breached.  
- All automated actions (test and production) are persisted to the `automated_actions_audit` table. The SQL migration is under `supabase/migrations/001_create_automated_actions_audit.sql`.

## Forensic Gate ‚Äî Operation Manual
- The Forensic Gate is enforced by CI (`.github/workflows/integration-test.yml`). A branch cannot be merged unless:
  - The integrity check passes: `scripts/verify_nc102_integrity.cjs` must confirm `scripts/hashes_applied.json` contains 854 dossiers.  
  - The sensor harness runs: `scripts/sensor_harness.cjs` replays cavitation/surge sequences; the CI must successfully persist an audit row via `scripts/persist_test.cjs` and `scripts/assert_audit_row.cjs`.  

- Failure policy: any failed step produces a failing CI run and blocks merge. Review artifacts uploaded by the workflow (`artifacts/**`) to investigate failures.

## Domain & Secrets
- GitHub Actions Secrets (required):
  - `SUPABASE_URL` ‚Äî your Supabase project URL (e.g. `https://<project>.supabase.co`)  
  - `SUPABASE_KEY` ‚Äî service role key or a key with INSERT/select permissions for `automated_actions_audit`.  

- Vercel / Production env vars (required):
  - `VITE_SUPABASE_URL` ‚Äî Supabase URL for client-side features.  
  - `VITE_SUPABASE_ANON_KEY` ‚Äî Supabase anon key for public reads (if used).  

- Note: For CI integration and automated writes, use a service role key with controlled access; do not publish the service role key in client-side code or public repos.

## Engineering Core ‚Äî Formulas & Heuristics
- Efficiency (used in performance guards):
  $$\eta = \frac{P}{\rho \cdot g \cdot Q \cdot H}$$
  - P: output power (W)
  - œÅ: fluid density (kg/m^3)
  - g: gravitational acceleration (9.81 m/s^2)
  - Q: volumetric flow (m^3/s)
  - H: net head (m)

- RUL (Remaining Useful Life) kernel (from `MasterIntelligenceEngine.calculateRUL` and used by the harness):
  - vibFactor = (vibration / 1.5)^2
  - oilFactor = oilParticles / 100
  - totalDegradation = (vibFactor * 1.5) + (oilFactor * 2.5)
  - RUL = floor(BASE_LIFE / max(1, totalDegradation)) ; BASE_LIFE = 20000 hours

- Cavitation classification (sensor harness heuristic):
  - `cavitationLevel < 3` ‚Üí NOMINAL
  - `3 <= cavitationLevel < 7` ‚Üí WARNING
  - `cavitationLevel >= 7` ‚Üí CRITICAL

## Key Files (quick links)
- Canonical manifest: [scripts/hashes_applied.json](scripts/hashes_applied.json)
- Runtime resolver: [src/data/knowledge/DossierLibrary.ts](src/data/knowledge/DossierLibrary.ts)
- Master engine: [src/services/MasterIntelligenceEngine.ts](src/services/MasterIntelligenceEngine.ts)
- Supabase migration: [supabase/migrations/001_create_automated_actions_audit.sql](supabase/migrations/001_create_automated_actions_audit.sql)
- CI workflow: [.github/workflows/integration-test.yml](.github/workflows/integration-test.yml)

## Running the Harness Locally
1. Ensure node and dependencies are installed: `npm ci`  
2. (Optional) To test Supabase writes: set environment variables in your shell:  
   ```powershell
   $env:INTEGRATION_MODE='true'
   $env:SUPABASE_URL='https://<your-project>.supabase.co'
   $env:SUPABASE_KEY='<your-service-role-key>'
   node ./scripts/persist_test.cjs
   ```
3. For offline/local-only tests (safe): run `node ./scripts/sensor_harness.cjs` ‚Äî results are written to `./artifacts`.

## Clean Workspace
- Runtime artifacts are written to `artifacts/`. This path is ignored via `.gitignore` to avoid polluting the repository with test files.

---
For questions or to automate the next step (auto-deploy the Forensic Gate), open an issue titled "Forensic Gate: Auto-deploy" and assign to the release lead.
# AnoHUB SCADA System

## State of the Union (v1.0.0 - Synapse Integration)

**AnoHUB** is a next-generation Hydroelectric Power Plant (HPP) SCADA and Maintenance application. It bridges the gap between traditional industrial control and modern intuitive UX.

### üåü Key Features

#### 1. The "Francis Hub" (Turbine Friend)
A centralized ecosystem of 22 interactive Standard Operating Procedures (SOPs), categorized into 5 critical sectors.
*   **3D Digital Twin**: Interactive, real-time 3D visualization of the Francis Runner using `react-three-fiber`.
*   **Live Physics**: Real-time headers displaying RPM, Grid Frequency (Hz), and Active Power (MW).

#### 2. Reality Bridge (Supabase Persistence)
*   **Cloud Sync**: Infinite persistence for Maintenance Logs and Work Orders via Supabase.
*   **Realtime Collaboration**: Instant updates across clients using Postgres Changes.
*   **Optimistic UI**: Immediate interface feedback while data saves in the background.

#### 3. Synapse Integration (The "Golden Thread")
Modules are no longer isolated. The system features a "Golden Thread" workflow:
*   **Detection**: An engineer identifies a risk in an SOP (e.g., Water Hammer > 20 bar).
*   **Action**: A unified "Log Observation" button instantly creates a ticket.
*   **Routing**: The system navigates to the `Maintenance Logbook`, pre-filling context.

#### 4. Grid Handshake Protocol (NC-27)
*   **Autonomous Negotiation**: Integrated IEC 61850 compliant handshake for real-time power adjustment.
*   **Sovereign Limits**: Hard-coded 15 MW per unit limit enforced via cryptographic signature.
*   **Grid Transparency**: Full audit trail of all accepted and declined power requests in the Forensic Dashboard.

#### 5. Mobile HUD & Executive Awareness
*   **Responsive Control**: Optimized touch interface for site engineers to log observations on-the-go.
*   **Executive Pulse**: Real-time fleet health aggregation for non-technical stakeholders.

#### 6. Enterprise-Grade Foundation
*   **Global Command Palette**: `Ctrl+K` navigation to any module instantly.
*   **Internationalization (i18n)**: Full support for 6 languages (EN, ES, FR, DE, ZH, BS).
*   **PDF Generation**: Local-first PDF report generation with embedded custom fonts.
*   **Modular Architecture**: Clean separation of routes (`FrancisRouter`, `MaintenanceRouter`).

### üõ† Tech Stack
*   **Frontend**: React, TypeScript, Vite.
*   **3D Engine**: Three.js, React Three Fiber, Drei.
*   **Backend**: Supabase (PostgreSQL, Realtime, Auth).
*   **Styling**: Tailwind CSS (Executive/Dark Industrial Theme).
*   **Animation**: Framer Motion.
*   **State Management**: React Context + Supabase Subscription.
*   **Routing**: React Router v6.
*   **Icons**: Lucide React.

### üöÄ Getting Started

```bash
# Install dependencies
npm install

# Run development server
npm run dev
```

### üìÇ Architecture Overview

*   `src/components/francis/*`: SOP Implementation (Visual & Interactive).
*   `src/components/three/*`: 3D Models and Visualization Components.
*   `src/services/supabaseClient.ts`: Database Connection & Helpers.
*   `src/contexts/MaintenanceContext.tsx`: Realtime State Management.
*   `src/routes/paths.ts`: Centralized Route Constants.
*   `src/i18n/*`: Localization files.
*   `src/models/*`: Physics & Engineering Types.

---
*Built by the AnoHUB Engineering Team (Deepmind + User Pair Programming)* 
*Status: READY FOR PHASE 5 (Context Engine)*